# Handoff Notes — 2025-10-31 09:50 Z

This document summarizes the current state, how to build/run, and the next actions for the Procedural Tectonic Planets (PTP) UE 5.5 project.

## Current State (Phase 1)
- Completed: 1.1–1.8
  - Plugin + editor modules (GaiaPTP/GaiaPTPEditor)
  - DeveloperSettings with Appendix A constants
  - Fibonacci sampler with tests (count/radius/uniformity)
  - Core data structures (FCrustData, FTerrane, FTectonicPlate) + tests
  - Plate seeding + Voronoi (AssignPointsToSeeds) + test
  - CGAL-backed adjacency via wrapper lib (ptp_cgal.lib) + smoke/integrity tests
  - Debug visualization (1.7): point‑preview using RealtimeMeshComponent (colored quads by plate), double‑sided and 32‑bit indices
  - Profiling + deterministic work (1.8): CSV scopes + RNG wrapper + determinism tests

## How to Build & Test
- One-liner build + full test suite:
  - `PowerShell ./Scripts/BuildAndTest-PTP.ps1`
- Targeted tests (faster):
  - `PowerShell ./Scripts/BuildAndTest-PTP.ps1 -Filters "GaiaPTP.Adjacency.Smoke","GaiaPTP.Adjacency.Integrity"`
  - `PowerShell ./Scripts/BuildAndTest-PTP.ps1 -Filters "GaiaPTP.Determinism.Sampling","GaiaPTP.Determinism.Seeding"`
- Editor launch (manual):
  - `"%UE5_DIR%\Engine\Binaries\Win64\UnrealEditor.exe" "%CD%\Gaia.uproject"`

## CGAL Setup
- Install via vcpkg (if not already): `./Scripts/Setup-CGAL.ps1`
- Build wrapper lib (if needed): `./Scripts/Build-PTP-CGAL.ps1`
- Detection: module auto-finds `VCPKG_ROOT` (defaults to `C:\Users\<user>\vcpkg`) and links ptp_cgal.lib; gmp/mpfr DLLs are delay‑loaded and staged by script.

## Profiling
- CSV category: `GAIA_PTP` (core) and `GAIA_PTP_CGAL` (CGAL module)
- Commands in console:
  - `ptp.profile.start` — begin capture
  - `ptp.profile.stop` — end capture
- CSV output: `Saved/Profiling/CSV`
- Timed scopes: Sampling, Seeding, SeedingAssign, Adjacency, PreviewBuild

## Using the Preview
- Place `APTPPlanetActor` in a level.
- Per-actor overrides in `UPTPPlanetComponent` (Details panel):
  - `NumSamplePoints` (truth), `DebugDrawStride` (visual density), `PlanetRadiusKm`, `NumPlates`, etc.
- Preview draws surface‑aligned quads at every Nth sample (`DebugDrawStride`). Colors = plate IDs. Double‑sided rendering enabled.

## Key Files
- Sampling: `Plugins/GaiaPTP/.../FibonacciSphere.*`
- Data types: `Plugins/GaiaPTP/.../TectonicTypes.h`, `TectonicData.h`
- Seeding: `Plugins/GaiaPTP/.../TectonicSeeding.*`
- Adjacency (CGAL):
  - Wrapper: `Plugins/GaiaPTP/ThirdParty/PTP_CGAL/` (CMake, ptp_cgal.lib)
  - UE provider: `Plugins/GaiaPTP/Source/GaiaPTPCGAL/Private/CGALAdjacencyProvider.cpp`
- Actor/Component: `.../PTPPlanetActor.*`, `.../PTPPlanetComponent.*`
- Profiling: `.../PTPProfiling.*`
- Tests: `.../Tests/*`
- Scripts: `Scripts/BuildAndTest-PTP.ps1`, `Scripts/Setup-CGAL.ps1`, `Scripts/Build-PTP-CGAL.ps1`

## Open Items / Next Steps
- Phase 2: Plate movement + Subduction kernels (use neighbor/boundary info).
- Optional (visual): Add “Surface preview” mode that renders the CGAL triangle mesh (colored by plate/elevation) alongside the existing point preview.
- Editor utility: Button to “Build Adjacency” + toggle between `Points`/`Surface` preview modes.
- Determinism: Route future randomized steps through `FPTPRandom` using `InitialSeed` in settings.
- Warnings: Engine logs show USD plugin resource warnings (benign) and RMC StructUtils deprecation (UE 5.5); track for later upgrade.

## Quick Troubleshooting
- CGAL module fails to load: ensure `VCPKG_ROOT` is set and `ThirdParty/PTP_CGAL/build/Release/ptp_cgal.lib` exists; rerun `Build-PTP-CGAL.ps1`.
- Missing DLLs at runtime: `BuildAndTest-PTP.ps1` stages `gmp-10.dll`, `gmpxx-4.dll`, `mpfr-6.dll` and adds vcpkg/bin to PATH.
- Preview culls half the sphere: fixed by double‑sided markers; update is already in `PTPPlanetActor.cpp`.

## Ready-to-Run Checklist
- [ ] PowerShell: `./Scripts/BuildAndTest-PTP.ps1 -Filters "GaiaPTP.Adjacency.Smoke","GaiaPTP.Adjacency.Integrity"` — both pass
- [ ] Place `APTPPlanetActor`; adjust `DebugDrawStride` for density
- [ ] (Optional) `ptp.profile.start` → interact → `ptp.profile.stop` and inspect CSV

---
Owner: Codex stream handoff
